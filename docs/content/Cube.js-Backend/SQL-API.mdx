---
title: SQL API
permalink: /backend/sql
category: Cube.js Backend
menuOrder: 5
---

<WarningBox heading={`🐣  Preview`}>

The Cube SQL connector is currently in Preview, and there may be changes in a
future version. Full support of the ANSI SQL standard is not guaranteed.

</WarningBox>

Cube SQL is a SQL emulation layer for Cube.

It is extremely useful for integrating with existing Business Intelligence (BI)
tools such as Apache Superset, Microsoft PowerBI etc.

<InfoBox>

To see an example of Cube connecting to Apache Superset, check out this recipe.

</InfoBox>

## Enabling the connector

To enable the Cube SQL connector, we first need to add a new environment
variable:

```dotenv
CUBEJS_SQL_PORT=3306
```

Cube SQL uses the same JWTs as Cube, so we first need to create a JWT from the
`CUBEJS_API_SECRET` or from our external identity provider if custom JWK
authentication is configured. Assuming the JWT has been generated, we can
connect using the `mysql` client:

```bash
# Format: mysql -h <CUBE_IP> --port <CUBE_SQL_PORT> -u <JWT_STRING>
mysql -h 127.0.0.1 --port 3306 -u eyJhbGc...
```

Because MySQL does not support JWT authentication, Cube SQL retrieves the JWT
from the `username` parameter.

## Querying Dimensions

Querying dimensions is straightforward, simply add any required fields to the
`SELECT` clause:

> ADD CUBE SCHEMA HERE

```javascript

```

```sql
SELECT id FROM Orders GROUP BY id;
```

## Querying Measures

Measures can also be queried through Cube SQL, just make sure to use the right
aggregation function for the measure.

> ADD CUBE SCHEMA HERE

```javascript

```

```sql
MIN(measureName)
MAX(measure)
COUNT(*)
COUNT(DISTINCT measureName)
COUNT(DISTINCT measureNameWithCountDistinctApprox)
MEASURE(measureName)
```

## Querying Segments

Any segments defined in a schema can also be used in Cube SQL queries. Segments
must be used as `boolean` types:

> ADD CUBE SCHEMA HERE

```javascript

```

> Add CUBE SQL HERE

## Limitations

### SELECT

`SELECT` statements only support the following projections:

**`*` for all dimensions:**

```sql
SELECT * FROM Orders;
```

**A valid expression for a dimension or measure:**

```sql
SELECT COUNT(*) FROM Orders;
```

**A valid expression as an alias:**

```sql
SELECT COUNT(*) AS order_count FROM Orders;
```

### WHERE

Cube SQL supports most conditional checks for the `WHERE` clause.

**Comparison operators:**

```sql
WHERE price > 50
WHERE price >= 50 AND <= 100
```

**Boolean logic:**

```sql
WHERE is_paid = true
  AND is_completed = false
  OR is_reviewed = false
```

**`IN` operator:**:

```sql
WHERE status IN ('completed', 'shipped')
WHERE status NOT IN ('processing')
```

**`IS NULL`:**

```sql
WHERE completed_at IS NULL
WHERE completed_at IS NOT NULL
```

**`BETWEEN`:**

```sql
WHERE completed_at BETWEEN '2021-08-31' AND '2021-09-07'
WHERE created_at NOT BETWEEN '2021-08-31' AND '2021-09-07'
```

**`LIKE`:**

```sql
WHERE name LIKE 'joe'
WHERE name NOT LIKE 'bloggs'
```

**Functions:**

Currently Cube SQL only supports [`STR_TO_DATE()`][mysql-docs-str-to-date].

### GROUP BY

`GROUP BY` clauses in SQL queries sent to Cube SQL are ignored; Cube SQL follows
the same rules as Cube. Any defined dimensions/measures will be grouped **by
default**, and currently there is no way to retrieve ungrouped results.

[mysql-docs-str-to-date]:
  https://dev.mysql.com/doc/refman/8.0/en/date-and-time-functions.html#function_str-to-date
